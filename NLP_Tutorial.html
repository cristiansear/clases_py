

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>NLP &#8212; Clases de Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'NLP_Tutorial';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Importing the transformer" href="OffensiveEJPM.html" />
    <link rel="prev" title="Analyze A/B Test Results" href="Analyze_ab_test_results_notebook.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Clases de Pyhton de la Diplomatura de Ciencia de Datos
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="Lecture_2.html">Introduction to Python: Tuples, Lists, Dictionaries, Arrays</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="group_8_ass_1_2022.html">1 Assignment</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="Lecture_3.html">3. <a id="intro">Pandas</a></a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="group_8_ass_2_2022.html">1 Assignment</a></li>

<li class="toctree-l2"><a class="reference internal" href="group_1_ass_3_2022.html">1 Assignment 3</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="Lecture_4.html">4. If and Loops</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="group_1_ass_4_2022.html">Assigment 4</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Lecture_5.html">5. Functions and Class</a></li>

<li class="toctree-l1"><a class="reference internal" href="Lecture_6.html">Inheritance, Private Variables, Fixed attributes, Costumize Exceptions with Python</a></li>

<li class="toctree-l1"><a class="reference internal" href="lecture_7R.html">7. Web Scraping</a></li>






<li class="toctree-l1"><a class="reference internal" href="Lecture_8.html">8. API</a></li>

<li class="toctree-l1"><a class="reference internal" href="Visualitazion.html">1. Quantities:</a></li>





<li class="toctree-l1"><a class="reference internal" href="Geopandas1.html">¿Geopandas?</a></li>























<li class="toctree-l1"><a class="reference internal" href="Folium.html">FOLIUM:</a></li>








<li class="toctree-l1"><a class="reference internal" href="Causal_Infenrece.html">1 Causal Inference</a></li>

<li class="toctree-l1 current active"><a class="current reference internal" href="#">NLP</a></li>

</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2FNLP_Tutorial.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/NLP_Tutorial.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>NLP</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">NLP</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#text-pre-processing">Text Pre Processing</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#tokenizacion">Tokenización</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#instalacion-y-configuracion-spacy">Instalación y Configuración Spacy</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tokenizacion-por-sentencia">Tokenización por sentencia</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tokenizacion-por-espacio">1) Tokenización por espacio</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tokenizacion-basado-en-palabras">2) Tokenización basado en palabras</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tokenizacion-para-sub-palabras">3) Tokenización para sub-palabras</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-encoding-vectorizacion">Feature Encoding - Vectorización</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#buscando-similaridad">Buscando Similaridad</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reentrenando-modelos-de-nlp-fine-tuning">Reentrenando modelos de NLP (FINE-TUNING)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="nlp">
<h1>NLP<a class="headerlink" href="#nlp" title="Permalink to this heading">#</a></h1>
<p>Es una área de estudio que se enfoca en el procesamiento de la información contenida en lenguaje natural.</p>
<section id="text-pre-processing">
<h2>Text Pre Processing<a class="headerlink" href="#text-pre-processing" title="Permalink to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Segmentacion de textos y tokenizacion de palabras</p></li>
<li><p>Identificación del Idioma</p></li>
<li><p>Eliminar las punctuaciones, digitos, y palabras como articulos, determinantes.</p></li>
</ol>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="tokenizacion">
<h1>Tokenización<a class="headerlink" href="#tokenizacion" title="Permalink to this heading">#</a></h1>
<section id="instalacion-y-configuracion-spacy">
<h2>Instalación y Configuración Spacy<a class="headerlink" href="#instalacion-y-configuracion-spacy" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install --upgrade spacy
<span class="o">!</span>pip install transformers
<span class="o">!</span>python -m spacy download es_core_news_lg
<span class="kn">import</span> <span class="nn">spacy</span>
<span class="kn">from</span> <span class="nn">spacy</span> <span class="kn">import</span> <span class="n">displacy</span>
<span class="n">nlp</span> <span class="o">=</span> <span class="n">spacy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;es_core_news_lg&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>^CRequirement already satisfied: spacy in c:\anaconda\lib\site-packages (3.5.1)
Collecting spacy
  Downloading spacy-3.5.2-cp39-cp39-win_amd64.whl (12.2 MB)
     ------------------------------------- 12.2/12.2 MB 807.2 kB/s eta 0:00:00
Requirement already satisfied: pathy&gt;=0.10.0 in c:\anaconda\lib\site-packages (from spacy) (0.10.1)
Requirement already satisfied: langcodes&lt;4.0.0,&gt;=3.2.0 in c:\anaconda\lib\site-packages (from spacy) (3.3.0)
Requirement already satisfied: tqdm&lt;5.0.0,&gt;=4.38.0 in c:\anaconda\lib\site-packages (from spacy) (4.64.1)
Requirement already satisfied: srsly&lt;3.0.0,&gt;=2.4.3 in c:\anaconda\lib\site-packages (from spacy) (2.4.6)
Requirement already satisfied: cymem&lt;2.1.0,&gt;=2.0.2 in c:\anaconda\lib\site-packages (from spacy) (2.0.7)
Requirement already satisfied: smart-open&lt;7.0.0,&gt;=5.2.1 in c:\anaconda\lib\site-packages (from spacy) (5.2.1)
Requirement already satisfied: jinja2 in c:\anaconda\lib\site-packages (from spacy) (2.11.3)
Requirement already satisfied: typer&lt;0.8.0,&gt;=0.3.0 in c:\anaconda\lib\site-packages (from spacy) (0.7.0)
Requirement already satisfied: setuptools in c:\anaconda\lib\site-packages (from spacy) (63.4.1)
Requirement already satisfied: spacy-legacy&lt;3.1.0,&gt;=3.0.11 in c:\anaconda\lib\site-packages (from spacy) (3.0.12)
Requirement already satisfied: spacy-loggers&lt;2.0.0,&gt;=1.0.0 in c:\anaconda\lib\site-packages (from spacy) (1.0.4)
Requirement already satisfied: pydantic!=1.8,!=1.8.1,&lt;1.11.0,&gt;=1.7.4 in c:\anaconda\lib\site-packages (from spacy) (1.10.7)
Requirement already satisfied: wasabi&lt;1.2.0,&gt;=0.9.1 in c:\anaconda\lib\site-packages (from spacy) (1.1.1)
Requirement already satisfied: packaging&gt;=20.0 in c:\anaconda\lib\site-packages (from spacy) (21.3)
Requirement already satisfied: numpy&gt;=1.15.0 in c:\anaconda\lib\site-packages (from spacy) (1.21.5)
Requirement already satisfied: requests&lt;3.0.0,&gt;=2.13.0 in c:\anaconda\lib\site-packages (from spacy) (2.28.1)
Requirement already satisfied: catalogue&lt;2.1.0,&gt;=2.0.6 in c:\anaconda\lib\site-packages (from spacy) (2.0.8)
Requirement already satisfied: thinc&lt;8.2.0,&gt;=8.1.8 in c:\anaconda\lib\site-packages (from spacy) (8.1.9)
Requirement already satisfied: preshed&lt;3.1.0,&gt;=3.0.2 in c:\anaconda\lib\site-packages (from spacy) (3.0.8)
Requirement already satisfied: murmurhash&lt;1.1.0,&gt;=0.28.0 in c:\anaconda\lib\site-packages (from spacy) (1.0.9)
Requirement already satisfied: pyparsing!=3.0.5,&gt;=2.0.2 in c:\anaconda\lib\site-packages (from packaging&gt;=20.0-&gt;spacy) (3.0.9)
Requirement already satisfied: typing-extensions&gt;=4.2.0 in c:\anaconda\lib\site-packages (from pydantic!=1.8,!=1.8.1,&lt;1.11.0,&gt;=1.7.4-&gt;spacy) (4.3.0)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in c:\anaconda\lib\site-packages (from requests&lt;3.0.0,&gt;=2.13.0-&gt;spacy) (3.3)
Requirement already satisfied: charset-normalizer&lt;3,&gt;=2 in c:\anaconda\lib\site-packages (from requests&lt;3.0.0,&gt;=2.13.0-&gt;spacy) (2.0.4)
Requirement already satisfied: urllib3&lt;1.27,&gt;=1.21.1 in c:\anaconda\lib\site-packages (from requests&lt;3.0.0,&gt;=2.13.0-&gt;spacy) (1.26.11)
Requirement already satisfied: certifi&gt;=2017.4.17 in c:\anaconda\lib\site-packages (from requests&lt;3.0.0,&gt;=2.13.0-&gt;spacy) (2022.9.14)
Requirement already satisfied: blis&lt;0.8.0,&gt;=0.7.8 in c:\anaconda\lib\site-packages (from thinc&lt;8.2.0,&gt;=8.1.8-&gt;spacy) (0.7.9)
Requirement already satisfied: confection&lt;1.0.0,&gt;=0.0.1 in c:\anaconda\lib\site-packages (from thinc&lt;8.2.0,&gt;=8.1.8-&gt;spacy) (0.0.4)
Requirement already satisfied: colorama in c:\anaconda\lib\site-packages (from tqdm&lt;5.0.0,&gt;=4.38.0-&gt;spacy) (0.4.6)
Requirement already satisfied: click&lt;9.0.0,&gt;=7.1.1 in c:\anaconda\lib\site-packages (from typer&lt;0.8.0,&gt;=0.3.0-&gt;spacy) (8.0.4)
Requirement already satisfied: MarkupSafe&gt;=0.23 in c:\anaconda\lib\site-packages (from jinja2-&gt;spacy) (2.0.1)
Installing collected packages: spacy
  Attempting uninstall: spacy
    Found existing installation: spacy 3.5.1
    Uninstalling spacy-3.5.1:
      Successfully uninstalled spacy-3.5.1
Successfully installed spacy-3.5.2
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;El presidente de la República Pedro Castillo anunció la creación del denominado </span><span class="se">\</span>
<span class="s2">Servicio Civil Agrario - Secigra, con la finalidad de que “miles de jóvenes universitarios </span><span class="se">\</span>
<span class="s2">recién egresados” vayan al campo para brindar apoyo técnico “a nuestros agricultores </span><span class="se">\</span>
<span class="s2">y agricultoras”. “Tenemos en preparación un programa de servicio civil agrario, al que llamamos </span><span class="se">\</span>
<span class="s2">Secigra-Agrario, por lo cual miles de jóvenes universitarios, recién egresados, saldrán al </span><span class="se">\</span>
<span class="s2">campo a apoyar técnicamente a nuestro agricultores”, expresó.&quot;&quot;&quot;</span>
<span class="n">text</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;El presidente de la República Pedro Castillo anunció la creación del denominado Servicio Civil Agrario - Secigra, con la finalidad de que “miles de jóvenes universitarios recién egresados” vayan al campo para brindar apoyo técnico “a nuestros agricultores y agricultoras”. “Tenemos en preparación un programa de servicio civil agrario, al que llamamos Secigra-Agrario, por lo cual miles de jóvenes universitarios, recién egresados, saldrán al campo a apoyar técnicamente a nuestro agricultores”, expresó.&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="tokenizacion-por-sentencia">
<h2>Tokenización por sentencia<a class="headerlink" href="#tokenizacion-por-sentencia" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">doc</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">sent</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">sents</span><span class="p">):</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sentencia </span><span class="si">{</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">: &#39;</span><span class="p">,</span> <span class="n">sent</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>sentencia 1:  El presidente de la República Pedro Castillo anunció la creación del denominado Servicio Civil Agrario - Secigra, con la finalidad de que “miles de jóvenes universitarios recién egresados” vayan al campo para brindar apoyo técnico “a nuestros agricultores y agricultoras”.

sentencia 2:  “Tenemos en preparación un programa de servicio civil agrario, al que llamamos Secigra-Agrario, por lo cual miles de jóvenes universitarios, recién egresados, saldrán al campo a apoyar técnicamente a nuestro agricultores”, expresó.
</pre></div>
</div>
</div>
</div>
</section>
<section id="tokenizacion-por-espacio">
<h2>1) Tokenización por espacio<a class="headerlink" href="#tokenizacion-por-espacio" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;El&#39;, &#39;presidente&#39;, &#39;de&#39;, &#39;la&#39;, &#39;República&#39;, &#39;Pedro&#39;, &#39;Castillo&#39;, &#39;anunció&#39;, &#39;la&#39;, &#39;creación&#39;, &#39;del&#39;, &#39;denominado&#39;, &#39;Servicio&#39;, &#39;Civil&#39;, &#39;Agrario&#39;, &#39;-&#39;, &#39;Secigra,&#39;, &#39;con&#39;, &#39;la&#39;, &#39;finalidad&#39;, &#39;de&#39;, &#39;que&#39;, &#39;“miles&#39;, &#39;de&#39;, &#39;jóvenes&#39;, &#39;universitarios&#39;, &#39;recién&#39;, &#39;egresados”&#39;, &#39;vayan&#39;, &#39;al&#39;, &#39;campo&#39;, &#39;para&#39;, &#39;brindar&#39;, &#39;apoyo&#39;, &#39;técnico&#39;, &#39;“a&#39;, &#39;nuestros&#39;, &#39;agricultores&#39;, &#39;y&#39;, &#39;agricultoras”.&#39;, &#39;“Tenemos&#39;, &#39;en&#39;, &#39;preparación&#39;, &#39;un&#39;, &#39;programa&#39;, &#39;de&#39;, &#39;servicio&#39;, &#39;civil&#39;, &#39;agrario,&#39;, &#39;al&#39;, &#39;que&#39;, &#39;llamamos&#39;, &#39;Secigra-Agrario,&#39;, &#39;por&#39;, &#39;lo&#39;, &#39;cual&#39;, &#39;miles&#39;, &#39;de&#39;, &#39;jóvenes&#39;, &#39;universitarios,&#39;, &#39;recién&#39;, &#39;egresados,&#39;, &#39;saldrán&#39;, &#39;al&#39;, &#39;campo&#39;, &#39;a&#39;, &#39;apoyar&#39;, &#39;técnicamente&#39;, &#39;a&#39;, &#39;nuestro&#39;, &#39;agricultores”,&#39;, &#39;expresó.&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="tokenizacion-basado-en-palabras">
<h2>2) Tokenización basado en palabras<a class="headerlink" href="#tokenizacion-basado-en-palabras" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">spacy.tokenizer</span> <span class="kn">import</span> <span class="n">Tokenizer</span>
<span class="kn">from</span> <span class="nn">spacy.lang.es</span> <span class="kn">import</span> <span class="n">Spanish</span>
<span class="n">nlp</span> <span class="o">=</span> <span class="n">Spanish</span><span class="p">()</span>
<span class="n">tokens</span> <span class="o">=</span> <span class="n">nlp</span><span class="o">.</span><span class="n">tokenizer</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">tokens</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[El, presidente, de, la, República, Pedro, Castillo, anunció, la, creación, del, denominado, Servicio, Civil, Agrario, -, Secigra, ,, con, la, finalidad, de, que, “, miles, de, jóvenes, universitarios, recién, egresados, ”, vayan, al, campo, para, brindar, apoyo, técnico, “, a, nuestros, agricultores, y, agricultoras, ”, ., “, Tenemos, en, preparación, un, programa, de, servicio, civil, agrario, ,, al, que, llamamos, Secigra-Agrario, ,, por, lo, cual, miles, de, jóvenes, universitarios, ,, recién, egresados, ,, saldrán, al, campo, a, apoyar, técnicamente, a, nuestro, agricultores, ”, ,, expresó, .]
</pre></div>
</div>
</div>
</div>
</section>
<section id="tokenizacion-para-sub-palabras">
<h2>3) Tokenización para sub-palabras<a class="headerlink" href="#tokenizacion-para-sub-palabras" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">BertTokenizer</span>
<span class="c1">#tz = BertTokenizer.from_pretrained(&quot;bert-base-cased&quot;)</span>
<span class="n">tz</span> <span class="o">=</span> <span class="n">BertTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;bert-base-multilingual-cased&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "23d879d2ed234a2d9e7154bdeeee416c"}</script><script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "8551e25951e7494eb8ff2bbdf08c05f4"}</script><script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "e1f1f78ea84c4667853ec645d551e34f"}</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tz</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;El&#39;,
 &#39;presidente&#39;,
 &#39;de&#39;,
 &#39;la&#39;,
 &#39;República&#39;,
 &#39;Pedro&#39;,
 &#39;Castillo&#39;,
 &#39;anunció&#39;,
 &#39;la&#39;,
 &#39;creación&#39;,
 &#39;del&#39;,
 &#39;denominado&#39;,
 &#39;Servicio&#39;,
 &#39;Civil&#39;,
 &#39;A&#39;,
 &#39;##gra&#39;,
 &#39;##rio&#39;,
 &#39;-&#39;,
 &#39;Sec&#39;,
 &#39;##ig&#39;,
 &#39;##ra&#39;,
 &#39;,&#39;,
 &#39;con&#39;,
 &#39;la&#39;,
 &#39;finali&#39;,
 &#39;##dad&#39;,
 &#39;de&#39;,
 &#39;que&#39;,
 &#39;[UNK]&#39;,
 &#39;miles&#39;,
 &#39;de&#39;,
 &#39;jóvenes&#39;,
 &#39;universitario&#39;,
 &#39;##s&#39;,
 &#39;recién&#39;,
 &#39;e&#39;,
 &#39;##gres&#39;,
 &#39;##ados&#39;,
 &#39;[UNK]&#39;,
 &#39;va&#39;,
 &#39;##yan&#39;,
 &#39;al&#39;,
 &#39;campo&#39;,
 &#39;para&#39;,
 &#39;br&#39;,
 &#39;##inda&#39;,
 &#39;##r&#39;,
 &#39;apoyo&#39;,
 &#39;técnico&#39;,
 &#39;[UNK]&#39;,
 &#39;a&#39;,
 &#39;nuestros&#39;,
 &#39;ag&#39;,
 &#39;##ricu&#39;,
 &#39;##lto&#39;,
 &#39;##res&#39;,
 &#39;y&#39;,
 &#39;ag&#39;,
 &#39;##ricu&#39;,
 &#39;##lto&#39;,
 &#39;##ras&#39;,
 &#39;[UNK]&#39;,
 &#39;.&#39;,
 &#39;[UNK]&#39;,
 &#39;Ten&#39;,
 &#39;##emos&#39;,
 &#39;en&#39;,
 &#39;preparación&#39;,
 &#39;un&#39;,
 &#39;programa&#39;,
 &#39;de&#39;,
 &#39;servicio&#39;,
 &#39;civil&#39;,
 &#39;ag&#39;,
 &#39;##rar&#39;,
 &#39;##io&#39;,
 &#39;,&#39;,
 &#39;al&#39;,
 &#39;que&#39;,
 &#39;llama&#39;,
 &#39;##mos&#39;,
 &#39;Sec&#39;,
 &#39;##ig&#39;,
 &#39;##ra&#39;,
 &#39;-&#39;,
 &#39;A&#39;,
 &#39;##gra&#39;,
 &#39;##rio&#39;,
 &#39;,&#39;,
 &#39;por&#39;,
 &#39;lo&#39;,
 &#39;cual&#39;,
 &#39;miles&#39;,
 &#39;de&#39;,
 &#39;jóvenes&#39;,
 &#39;universitario&#39;,
 &#39;##s&#39;,
 &#39;,&#39;,
 &#39;recién&#39;,
 &#39;e&#39;,
 &#39;##gres&#39;,
 &#39;##ados&#39;,
 &#39;,&#39;,
 &#39;sal&#39;,
 &#39;##dr&#39;,
 &#39;##án&#39;,
 &#39;al&#39;,
 &#39;campo&#39;,
 &#39;a&#39;,
 &#39;apo&#39;,
 &#39;##yar&#39;,
 &#39;técnica&#39;,
 &#39;##mente&#39;,
 &#39;a&#39;,
 &#39;nuestro&#39;,
 &#39;ag&#39;,
 &#39;##ricu&#39;,
 &#39;##lto&#39;,
 &#39;##res&#39;,
 &#39;[UNK]&#39;,
 &#39;,&#39;,
 &#39;ex&#39;,
 &#39;##pres&#39;,
 &#39;##ó&#39;,
 &#39;.&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="feature-encoding-vectorizacion">
<h2>Feature Encoding - Vectorización<a class="headerlink" href="#feature-encoding-vectorizacion" title="Permalink to this heading">#</a></h2>
<p>Las oraciones podemos generarlas como vectores. Luego, cada palabra ahora representa un vector, pero esta caracterizado por su contexto en las oraciones que se encuentran. De esta manera, hallamos similaridades entre palabras utilizando vectores.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install <span class="nv">gensim</span><span class="o">==</span><span class="m">3</span>.8.0
<span class="o">!</span>pip install pyemd
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/
Requirement already satisfied: gensim==3.8.0 in /usr/local/lib/python3.9/dist-packages (3.8.0)
Requirement already satisfied: smart-open&gt;=1.7.0 in /usr/local/lib/python3.9/dist-packages (from gensim==3.8.0) (6.3.0)
Requirement already satisfied: six&gt;=1.5.0 in /usr/local/lib/python3.9/dist-packages (from gensim==3.8.0) (1.16.0)
Requirement already satisfied: scipy&gt;=0.18.1 in /usr/local/lib/python3.9/dist-packages (from gensim==3.8.0) (1.10.1)
Requirement already satisfied: numpy&gt;=1.11.3 in /usr/local/lib/python3.9/dist-packages (from gensim==3.8.0) (1.22.4)
Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/
Collecting pyemd
  Downloading pyemd-1.0.0-cp39-cp39-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (675 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">675.0/675.0 KB</span> <span class=" -Color -Color-Red">18.3 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hRequirement already satisfied: numpy&gt;=1.9.0 in /usr/local/lib/python3.9/dist-packages (from pyemd) (1.22.4)
Installing collected packages: pyemd
Successfully installed pyemd-1.0.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install stanza
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">nltk</span>
<span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">stopwords</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">gensim</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">groupby</span>
<span class="kn">from</span> <span class="nn">gensim.similarities</span> <span class="kn">import</span> <span class="n">WmdSimilarity</span>
<span class="kn">from</span> <span class="nn">gensim.models</span> <span class="kn">import</span> <span class="n">Word2Vec</span>

<span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;punkt&#39;</span><span class="p">)</span> 
<span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;stopwords&#39;</span><span class="p">)</span>
<span class="n">stop_words</span> <span class="o">=</span> <span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s1">&#39;spanish&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">stanza</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="n">stanza</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;es&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stop_words</span><span class="p">)</span>
<span class="n">nlp</span> <span class="o">=</span> <span class="n">stanza</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">(</span><span class="n">processors</span><span class="o">=</span><span class="s1">&#39;tokenize&#39;</span><span class="p">,</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;es&#39;</span><span class="p">,</span><span class="n">use_gpu</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/
Requirement already satisfied: stanza in /usr/local/lib/python3.9/dist-packages (1.5.0)
Requirement already satisfied: emoji in /usr/local/lib/python3.9/dist-packages (from stanza) (2.2.0)
Requirement already satisfied: numpy in /usr/local/lib/python3.9/dist-packages (from stanza) (1.22.4)
Requirement already satisfied: tqdm in /usr/local/lib/python3.9/dist-packages (from stanza) (4.65.0)
Requirement already satisfied: protobuf in /usr/local/lib/python3.9/dist-packages (from stanza) (3.20.3)
Requirement already satisfied: torch&gt;=1.3.0 in /usr/local/lib/python3.9/dist-packages (from stanza) (1.13.1+cu116)
Requirement already satisfied: requests in /usr/local/lib/python3.9/dist-packages (from stanza) (2.27.1)
Requirement already satisfied: six in /usr/local/lib/python3.9/dist-packages (from stanza) (1.16.0)
Requirement already satisfied: typing-extensions in /usr/local/lib/python3.9/dist-packages (from torch&gt;=1.3.0-&gt;stanza) (4.5.0)
Requirement already satisfied: charset-normalizer~=2.0.0 in /usr/local/lib/python3.9/dist-packages (from requests-&gt;stanza) (2.0.12)
Requirement already satisfied: urllib3&lt;1.27,&gt;=1.21.1 in /usr/local/lib/python3.9/dist-packages (from requests-&gt;stanza) (1.26.15)
Requirement already satisfied: certifi&gt;=2017.4.17 in /usr/local/lib/python3.9/dist-packages (from requests-&gt;stanza) (2022.12.7)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in /usr/local/lib/python3.9/dist-packages (from requests-&gt;stanza) (3.4)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[nltk_data] Downloading package punkt to /root/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package stopwords to /root/nltk_data...
[nltk_data]   Package stopwords is already up-to-date!
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "d4b8477331974f8fadaec13c1d15400b"}</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:stanza:Downloading default packages for language: es (Spanish) ...
INFO:stanza:File exists: /root/stanza_resources/es/default.zip
INFO:stanza:Finished downloading models and saved to /root/stanza_resources.
INFO:stanza:Checking for updates to resources.json in case models have been updated.  Note: this behavior can be turned off with download_method=None or download_method=DownloadMethod.REUSE_RESOURCES
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;de&#39;, &#39;la&#39;, &#39;que&#39;, &#39;el&#39;, &#39;en&#39;, &#39;y&#39;, &#39;a&#39;, &#39;los&#39;, &#39;del&#39;, &#39;se&#39;, &#39;las&#39;, &#39;por&#39;, &#39;un&#39;, &#39;para&#39;, &#39;con&#39;, &#39;no&#39;, &#39;una&#39;, &#39;su&#39;, &#39;al&#39;, &#39;lo&#39;, &#39;como&#39;, &#39;más&#39;, &#39;pero&#39;, &#39;sus&#39;, &#39;le&#39;, &#39;ya&#39;, &#39;o&#39;, &#39;este&#39;, &#39;sí&#39;, &#39;porque&#39;, &#39;esta&#39;, &#39;entre&#39;, &#39;cuando&#39;, &#39;muy&#39;, &#39;sin&#39;, &#39;sobre&#39;, &#39;también&#39;, &#39;me&#39;, &#39;hasta&#39;, &#39;hay&#39;, &#39;donde&#39;, &#39;quien&#39;, &#39;desde&#39;, &#39;todo&#39;, &#39;nos&#39;, &#39;durante&#39;, &#39;todos&#39;, &#39;uno&#39;, &#39;les&#39;, &#39;ni&#39;, &#39;contra&#39;, &#39;otros&#39;, &#39;ese&#39;, &#39;eso&#39;, &#39;ante&#39;, &#39;ellos&#39;, &#39;e&#39;, &#39;esto&#39;, &#39;mí&#39;, &#39;antes&#39;, &#39;algunos&#39;, &#39;qué&#39;, &#39;unos&#39;, &#39;yo&#39;, &#39;otro&#39;, &#39;otras&#39;, &#39;otra&#39;, &#39;él&#39;, &#39;tanto&#39;, &#39;esa&#39;, &#39;estos&#39;, &#39;mucho&#39;, &#39;quienes&#39;, &#39;nada&#39;, &#39;muchos&#39;, &#39;cual&#39;, &#39;poco&#39;, &#39;ella&#39;, &#39;estar&#39;, &#39;estas&#39;, &#39;algunas&#39;, &#39;algo&#39;, &#39;nosotros&#39;, &#39;mi&#39;, &#39;mis&#39;, &#39;tú&#39;, &#39;te&#39;, &#39;ti&#39;, &#39;tu&#39;, &#39;tus&#39;, &#39;ellas&#39;, &#39;nosotras&#39;, &#39;vosotros&#39;, &#39;vosotras&#39;, &#39;os&#39;, &#39;mío&#39;, &#39;mía&#39;, &#39;míos&#39;, &#39;mías&#39;, &#39;tuyo&#39;, &#39;tuya&#39;, &#39;tuyos&#39;, &#39;tuyas&#39;, &#39;suyo&#39;, &#39;suya&#39;, &#39;suyos&#39;, &#39;suyas&#39;, &#39;nuestro&#39;, &#39;nuestra&#39;, &#39;nuestros&#39;, &#39;nuestras&#39;, &#39;vuestro&#39;, &#39;vuestra&#39;, &#39;vuestros&#39;, &#39;vuestras&#39;, &#39;esos&#39;, &#39;esas&#39;, &#39;estoy&#39;, &#39;estás&#39;, &#39;está&#39;, &#39;estamos&#39;, &#39;estáis&#39;, &#39;están&#39;, &#39;esté&#39;, &#39;estés&#39;, &#39;estemos&#39;, &#39;estéis&#39;, &#39;estén&#39;, &#39;estaré&#39;, &#39;estarás&#39;, &#39;estará&#39;, &#39;estaremos&#39;, &#39;estaréis&#39;, &#39;estarán&#39;, &#39;estaría&#39;, &#39;estarías&#39;, &#39;estaríamos&#39;, &#39;estaríais&#39;, &#39;estarían&#39;, &#39;estaba&#39;, &#39;estabas&#39;, &#39;estábamos&#39;, &#39;estabais&#39;, &#39;estaban&#39;, &#39;estuve&#39;, &#39;estuviste&#39;, &#39;estuvo&#39;, &#39;estuvimos&#39;, &#39;estuvisteis&#39;, &#39;estuvieron&#39;, &#39;estuviera&#39;, &#39;estuvieras&#39;, &#39;estuviéramos&#39;, &#39;estuvierais&#39;, &#39;estuvieran&#39;, &#39;estuviese&#39;, &#39;estuvieses&#39;, &#39;estuviésemos&#39;, &#39;estuvieseis&#39;, &#39;estuviesen&#39;, &#39;estando&#39;, &#39;estado&#39;, &#39;estada&#39;, &#39;estados&#39;, &#39;estadas&#39;, &#39;estad&#39;, &#39;he&#39;, &#39;has&#39;, &#39;ha&#39;, &#39;hemos&#39;, &#39;habéis&#39;, &#39;han&#39;, &#39;haya&#39;, &#39;hayas&#39;, &#39;hayamos&#39;, &#39;hayáis&#39;, &#39;hayan&#39;, &#39;habré&#39;, &#39;habrás&#39;, &#39;habrá&#39;, &#39;habremos&#39;, &#39;habréis&#39;, &#39;habrán&#39;, &#39;habría&#39;, &#39;habrías&#39;, &#39;habríamos&#39;, &#39;habríais&#39;, &#39;habrían&#39;, &#39;había&#39;, &#39;habías&#39;, &#39;habíamos&#39;, &#39;habíais&#39;, &#39;habían&#39;, &#39;hube&#39;, &#39;hubiste&#39;, &#39;hubo&#39;, &#39;hubimos&#39;, &#39;hubisteis&#39;, &#39;hubieron&#39;, &#39;hubiera&#39;, &#39;hubieras&#39;, &#39;hubiéramos&#39;, &#39;hubierais&#39;, &#39;hubieran&#39;, &#39;hubiese&#39;, &#39;hubieses&#39;, &#39;hubiésemos&#39;, &#39;hubieseis&#39;, &#39;hubiesen&#39;, &#39;habiendo&#39;, &#39;habido&#39;, &#39;habida&#39;, &#39;habidos&#39;, &#39;habidas&#39;, &#39;soy&#39;, &#39;eres&#39;, &#39;es&#39;, &#39;somos&#39;, &#39;sois&#39;, &#39;son&#39;, &#39;sea&#39;, &#39;seas&#39;, &#39;seamos&#39;, &#39;seáis&#39;, &#39;sean&#39;, &#39;seré&#39;, &#39;serás&#39;, &#39;será&#39;, &#39;seremos&#39;, &#39;seréis&#39;, &#39;serán&#39;, &#39;sería&#39;, &#39;serías&#39;, &#39;seríamos&#39;, &#39;seríais&#39;, &#39;serían&#39;, &#39;era&#39;, &#39;eras&#39;, &#39;éramos&#39;, &#39;erais&#39;, &#39;eran&#39;, &#39;fui&#39;, &#39;fuiste&#39;, &#39;fue&#39;, &#39;fuimos&#39;, &#39;fuisteis&#39;, &#39;fueron&#39;, &#39;fuera&#39;, &#39;fueras&#39;, &#39;fuéramos&#39;, &#39;fuerais&#39;, &#39;fueran&#39;, &#39;fuese&#39;, &#39;fueses&#39;, &#39;fuésemos&#39;, &#39;fueseis&#39;, &#39;fuesen&#39;, &#39;sintiendo&#39;, &#39;sentido&#39;, &#39;sentida&#39;, &#39;sentidos&#39;, &#39;sentidas&#39;, &#39;siente&#39;, &#39;sentid&#39;, &#39;tengo&#39;, &#39;tienes&#39;, &#39;tiene&#39;, &#39;tenemos&#39;, &#39;tenéis&#39;, &#39;tienen&#39;, &#39;tenga&#39;, &#39;tengas&#39;, &#39;tengamos&#39;, &#39;tengáis&#39;, &#39;tengan&#39;, &#39;tendré&#39;, &#39;tendrás&#39;, &#39;tendrá&#39;, &#39;tendremos&#39;, &#39;tendréis&#39;, &#39;tendrán&#39;, &#39;tendría&#39;, &#39;tendrías&#39;, &#39;tendríamos&#39;, &#39;tendríais&#39;, &#39;tendrían&#39;, &#39;tenía&#39;, &#39;tenías&#39;, &#39;teníamos&#39;, &#39;teníais&#39;, &#39;tenían&#39;, &#39;tuve&#39;, &#39;tuviste&#39;, &#39;tuvo&#39;, &#39;tuvimos&#39;, &#39;tuvisteis&#39;, &#39;tuvieron&#39;, &#39;tuviera&#39;, &#39;tuvieras&#39;, &#39;tuviéramos&#39;, &#39;tuvierais&#39;, &#39;tuvieran&#39;, &#39;tuviese&#39;, &#39;tuvieses&#39;, &#39;tuviésemos&#39;, &#39;tuvieseis&#39;, &#39;tuviesen&#39;, &#39;teniendo&#39;, &#39;tenido&#39;, &#39;tenida&#39;, &#39;tenidos&#39;, &#39;tenidas&#39;, &#39;tened&#39;]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "432ce07aa73d488f9d1e499499a78c11"}</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:stanza:Language es package default expects mwt, which has been added
INFO:stanza:Loading these models for language: es (Spanish):
=======================
| Processor | Package |
-----------------------
| tokenize  | ancora  |
| mwt       | ancora  |
=======================

INFO:stanza:Using device: cuda
INFO:stanza:Loading: tokenize
INFO:stanza:Loading: mwt
INFO:stanza:Done loading processors!
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Quitamos los stop words</span>
<span class="c1"># articulos, adverbios</span>
<span class="k">def</span> <span class="nf">preprocessing</span><span class="p">(</span><span class="n">words</span><span class="p">):</span>
  <span class="n">clean_sentence</span><span class="o">=</span><span class="p">[]</span>
  <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
    <span class="n">word</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stop_words</span><span class="p">)</span> <span class="ow">and</span> <span class="n">word</span><span class="o">.</span><span class="n">isalpha</span><span class="p">():</span>
      <span class="n">clean_sentence</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">clean_sentence</span>
      
<span class="c1"># Tomamos oraciones</span>
<span class="c1"># tokenizamos</span>
<span class="c1"># Generamos listas de oraciones limpias</span>
<span class="k">def</span> <span class="nf">preprocessing_sentences</span><span class="p">(</span><span class="n">all_news</span><span class="p">):</span>
  <span class="n">all_sentences</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">raw_sentences</span><span class="o">=</span><span class="p">[]</span>
  <span class="k">for</span> <span class="n">new</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">all_news</span><span class="p">):</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">sentences</span><span class="p">:</span>
      <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">sentence</span><span class="o">.</span><span class="n">words</span><span class="p">]</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">5</span><span class="p">:</span>
        <span class="n">clean_sentence</span><span class="o">=</span><span class="n">preprocessing</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
        <span class="n">all_sentences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">clean_sentence</span><span class="p">)</span>
        <span class="n">raw_sentences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">all_sentences</span><span class="p">,</span><span class="n">raw_sentences</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importar base de datos</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span> <span class="sa">r</span><span class="s2">&quot;https://www.dropbox.com/s/fjiwa26yjobrtfz/sample_news.csv?dl=1&quot;</span><span class="p">)</span>
<span class="c1"># Reemplazar np.nan</span>
<span class="c1"># por strings vacios</span>
<span class="n">df</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="c1"># String de oraciones</span>
<span class="n">all_news</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-13-94bc084f11b1&gt;</span> in <span class="ni">&lt;cell line: 5&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="c1"># Reemplazar np.nan</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="c1"># por strings vacios</span>
<span class="ne">----&gt; </span><span class="mi">5</span> <span class="n">df</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="c1"># String de oraciones</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="n">all_news</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

<span class="ne">NameError</span>: name &#39;np&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Procesamiento de las oraciones</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="n">sentences</span><span class="p">,</span><span class="n">raw_sentences</span> <span class="o">=</span> <span class="n">preprocessing_sentences</span><span class="p">(</span><span class="n">all_news</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="n">sentences</span><span class="p">)</span>
<span class="n">lens</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span> <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">sentences</span><span class="p">]</span>
<span class="n">avg_len</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">lens</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lens</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 300/300 [00:20&lt;00:00, 14.43it/s]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot de Longitud de las oraciones</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span> <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">sentences</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">avg_len</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#e41a1c&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Histograma de longitud de frases.&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Longitud&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="s1">&#39;mean = </span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">avg_len</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/58d4e676e419214df4dd0aa4e044c05e9aa82a41d198b573bbd9e8af7bdb8b76.png" src="_images/58d4e676e419214df4dd0aa4e044c05e9aa82a41d198b573bbd9e8af7bdb8b76.png" />
</div>
</div>
</section>
<section id="buscando-similaridad">
<h2>Buscando Similaridad<a class="headerlink" href="#buscando-similaridad" title="Permalink to this heading">#</a></h2>
<p>Con la base de datos que tenemos, generamos vectores de representación para cada palabra. De esta manera, podemos encontrar la similaridad entre palabras o frases.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Treinamos Word2Vec com todos las frases</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Word2Vec</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="n">workers</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">min_count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">word_vectors</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">wv</span>
<span class="c1"># Estoy buscando similaridad</span>
<span class="c1"># Los 10 mejores</span>
<span class="n">num_best</span> <span class="o">=</span> <span class="mi">10</span>
<span class="c1"># Genero con el modelo utilizando las 10mil primeras oraciones</span>
<span class="c1"># Con Insantance genero un buscador de similaridad</span>
<span class="n">instance</span> <span class="o">=</span> <span class="n">WmdSimilarity</span><span class="p">(</span><span class="n">sentences</span><span class="p">[:</span><span class="mi">10000</span><span class="p">],</span> <span class="n">model</span><span class="p">,</span> <span class="n">num_best</span><span class="o">=</span><span class="n">num_best</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Busco alcalde</span>
<span class="c1"># proveedores</span>
<span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;alcalde&#39;</span>
<span class="n">sentence</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">word_tokenize</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">language</span><span class="o">=</span><span class="s1">&#39;spanish&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="n">sims</span> <span class="o">=</span> <span class="n">instance</span><span class="p">[</span><span class="n">query</span><span class="p">]</span>  <span class="c1"># A query observa na classe de similaridade.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;alcalde&#39;]
[&#39;alcalde&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Mostramos los resultados de la pregunta</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Query:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_best</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sim = </span><span class="si">%.4f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sims</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sentences</span><span class="p">[</span><span class="n">sims</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Query:
alcalde

sim = 0.8569
prioridades alcalde culpe oposición

sim = 0.8308
horas mérida rueda prensa presidente grupo socialista guillermo fernández vara asamblea

sim = 0.8186
hemeroteca sede santa maría rábida

sim = 0.8103
psoe condena euforia pp

sim = 0.8085
horas toledo vicepresidente grupo parlamentario socialista santiago moreno ofrece rueda prensa cortes

sim = 0.8069
horas guadalajara portavoz grupo municipal socialista magndalena valerio ofrece rueda prensa ayuntamiento

sim = 0.8048
juan ignacio luca tena

sim = 0.8034
style center fernández relevará

sim = 0.8032
horas cáceres comienza pleno diputación cáceres

sim = 0.8029
sede provincial psoe
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">wv</span><span class="o">.</span><span class="n">most_similar</span><span class="p">(</span><span class="s1">&#39;proveedores&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;facturas&#39;, 0.9964778423309326),
 (&#39;pendientes&#39;, 0.9962916374206543),
 (&#39;pago&#39;, 0.9947641491889954),
 (&#39;deudas&#39;, 0.980039119720459),
 (&#39;total&#39;, 0.9785211086273193),
 (&#39;pagos&#39;, 0.9784457087516785),
 (&#39;importe&#39;, 0.9756489396095276),
 (&#39;entidades&#39;, 0.9752794504165649),
 (&#39;locales&#39;, 0.9667881727218628),
 (&#39;pagar&#39;, 0.9667481184005737)]
</pre></div>
</div>
</div>
</div>
</section>
<section id="reentrenando-modelos-de-nlp-fine-tuning">
<h2>Reentrenando modelos de NLP (FINE-TUNING)<a class="headerlink" href="#reentrenando-modelos-de-nlp-fine-tuning" title="Permalink to this heading">#</a></h2>
<p>Grandes empresas y centros de investigación ya generaron modelos pre entrenados con grandes cargas de bases de datos para clasificación, modelos de preguntas y respuestas, etc.</p>
<p>En este caso usaremos BERT (Google AI Language) un modelo pre entrenado que entiendo el contexto del lenguaje. A este modelo, se le necesita hacer un fine-tuning, es decir, reentrenarlo para una tarea en específico que deseamos realizar. En este caso, deseamos clasificar noticias si son o no relevantes. Para esto necesitamos una base de datos ya etiquetada,noticias que previamente ya hemos identificado si son o no relevantes. Y ajustaremos el modelo Bert para la tarea que desamos realizar.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#install the required libraries</span>
<span class="o">!</span>pip install transformers
<span class="o">!</span>pip install datasets
<span class="o">!</span>pip install pandas
<span class="o">!</span>pip install scikit-learn
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/
Requirement already satisfied: transformers in /usr/local/lib/python3.9/dist-packages (4.27.4)
Requirement already satisfied: pyyaml&gt;=5.1 in /usr/local/lib/python3.9/dist-packages (from transformers) (6.0)
Requirement already satisfied: huggingface-hub&lt;1.0,&gt;=0.11.0 in /usr/local/lib/python3.9/dist-packages (from transformers) (0.13.3)
Requirement already satisfied: tqdm&gt;=4.27 in /usr/local/lib/python3.9/dist-packages (from transformers) (4.65.0)
Requirement already satisfied: packaging&gt;=20.0 in /usr/local/lib/python3.9/dist-packages (from transformers) (23.0)
Requirement already satisfied: filelock in /usr/local/lib/python3.9/dist-packages (from transformers) (3.10.7)
Requirement already satisfied: numpy&gt;=1.17 in /usr/local/lib/python3.9/dist-packages (from transformers) (1.22.4)
Requirement already satisfied: tokenizers!=0.11.3,&lt;0.14,&gt;=0.11.1 in /usr/local/lib/python3.9/dist-packages (from transformers) (0.13.2)
Requirement already satisfied: requests in /usr/local/lib/python3.9/dist-packages (from transformers) (2.27.1)
Requirement already satisfied: regex!=2019.12.17 in /usr/local/lib/python3.9/dist-packages (from transformers) (2022.10.31)
Requirement already satisfied: typing-extensions&gt;=3.7.4.3 in /usr/local/lib/python3.9/dist-packages (from huggingface-hub&lt;1.0,&gt;=0.11.0-&gt;transformers) (4.5.0)
Requirement already satisfied: charset-normalizer~=2.0.0 in /usr/local/lib/python3.9/dist-packages (from requests-&gt;transformers) (2.0.12)
Requirement already satisfied: urllib3&lt;1.27,&gt;=1.21.1 in /usr/local/lib/python3.9/dist-packages (from requests-&gt;transformers) (1.26.15)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in /usr/local/lib/python3.9/dist-packages (from requests-&gt;transformers) (3.4)
Requirement already satisfied: certifi&gt;=2017.4.17 in /usr/local/lib/python3.9/dist-packages (from requests-&gt;transformers) (2022.12.7)
Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/
Collecting datasets
  Downloading datasets-2.11.0-py3-none-any.whl (468 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">468.7/468.7 KB</span> <span class=" -Color -Color-Red">15.5 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hRequirement already satisfied: requests&gt;=2.19.0 in /usr/local/lib/python3.9/dist-packages (from datasets) (2.27.1)
Collecting xxhash
  Downloading xxhash-3.2.0-cp39-cp39-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (212 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">212.2/212.2 KB</span> <span class=" -Color -Color-Red">27.6 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hCollecting aiohttp
  Downloading aiohttp-3.8.4-cp39-cp39-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (1.0 MB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">1.0/1.0 MB</span> <span class=" -Color -Color-Red">41.2 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hRequirement already satisfied: tqdm&gt;=4.62.1 in /usr/local/lib/python3.9/dist-packages (from datasets) (4.65.0)
Requirement already satisfied: fsspec[http]&gt;=2021.11.1 in /usr/local/lib/python3.9/dist-packages (from datasets) (2023.3.0)
Requirement already satisfied: packaging in /usr/local/lib/python3.9/dist-packages (from datasets) (23.0)
Requirement already satisfied: pyyaml&gt;=5.1 in /usr/local/lib/python3.9/dist-packages (from datasets) (6.0)
Collecting responses&lt;0.19
  Downloading responses-0.18.0-py3-none-any.whl (38 kB)
Requirement already satisfied: pandas in /usr/local/lib/python3.9/dist-packages (from datasets) (1.4.4)
Collecting multiprocess
  Downloading multiprocess-0.70.14-py39-none-any.whl (132 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">132.9/132.9 KB</span> <span class=" -Color -Color-Red">18.6 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hRequirement already satisfied: numpy&gt;=1.17 in /usr/local/lib/python3.9/dist-packages (from datasets) (1.22.4)
Requirement already satisfied: pyarrow&gt;=8.0.0 in /usr/local/lib/python3.9/dist-packages (from datasets) (9.0.0)
Requirement already satisfied: huggingface-hub&lt;1.0.0,&gt;=0.11.0 in /usr/local/lib/python3.9/dist-packages (from datasets) (0.13.3)
Collecting dill&lt;0.3.7,&gt;=0.3.0
  Downloading dill-0.3.6-py3-none-any.whl (110 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">110.5/110.5 KB</span> <span class=" -Color -Color-Red">15.6 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hCollecting multidict&lt;7.0,&gt;=4.5
  Downloading multidict-6.0.4-cp39-cp39-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (114 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">114.2/114.2 KB</span> <span class=" -Color -Color-Red">16.5 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hRequirement already satisfied: attrs&gt;=17.3.0 in /usr/local/lib/python3.9/dist-packages (from aiohttp-&gt;datasets) (22.2.0)
Collecting yarl&lt;2.0,&gt;=1.0
  Downloading yarl-1.8.2-cp39-cp39-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (264 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">264.6/264.6 KB</span> <span class=" -Color -Color-Red">28.7 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hCollecting aiosignal&gt;=1.1.2
  Downloading aiosignal-1.3.1-py3-none-any.whl (7.6 kB)
Collecting async-timeout&lt;5.0,&gt;=4.0.0a3
  Downloading async_timeout-4.0.2-py3-none-any.whl (5.8 kB)
Collecting frozenlist&gt;=1.1.1
  Downloading frozenlist-1.3.3-cp39-cp39-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl (158 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">158.8/158.8 KB</span> <span class=" -Color -Color-Red">21.5 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hRequirement already satisfied: charset-normalizer&lt;4.0,&gt;=2.0 in /usr/local/lib/python3.9/dist-packages (from aiohttp-&gt;datasets) (2.0.12)
Requirement already satisfied: filelock in /usr/local/lib/python3.9/dist-packages (from huggingface-hub&lt;1.0.0,&gt;=0.11.0-&gt;datasets) (3.10.7)
Requirement already satisfied: typing-extensions&gt;=3.7.4.3 in /usr/local/lib/python3.9/dist-packages (from huggingface-hub&lt;1.0.0,&gt;=0.11.0-&gt;datasets) (4.5.0)
Requirement already satisfied: certifi&gt;=2017.4.17 in /usr/local/lib/python3.9/dist-packages (from requests&gt;=2.19.0-&gt;datasets) (2022.12.7)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in /usr/local/lib/python3.9/dist-packages (from requests&gt;=2.19.0-&gt;datasets) (3.4)
Requirement already satisfied: urllib3&lt;1.27,&gt;=1.21.1 in /usr/local/lib/python3.9/dist-packages (from requests&gt;=2.19.0-&gt;datasets) (1.26.15)
Requirement already satisfied: pytz&gt;=2020.1 in /usr/local/lib/python3.9/dist-packages (from pandas-&gt;datasets) (2022.7.1)
Requirement already satisfied: python-dateutil&gt;=2.8.1 in /usr/local/lib/python3.9/dist-packages (from pandas-&gt;datasets) (2.8.2)
Requirement already satisfied: six&gt;=1.5 in /usr/local/lib/python3.9/dist-packages (from python-dateutil&gt;=2.8.1-&gt;pandas-&gt;datasets) (1.16.0)
Installing collected packages: xxhash, multidict, frozenlist, dill, async-timeout, yarl, responses, multiprocess, aiosignal, aiohttp, datasets
Successfully installed aiohttp-3.8.4 aiosignal-1.3.1 async-timeout-4.0.2 datasets-2.11.0 dill-0.3.6 frozenlist-1.3.3 multidict-6.0.4 multiprocess-0.70.14 responses-0.18.0 xxhash-3.2.0 yarl-1.8.2
Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/
Requirement already satisfied: pandas in /usr/local/lib/python3.9/dist-packages (1.4.4)
Requirement already satisfied: python-dateutil&gt;=2.8.1 in /usr/local/lib/python3.9/dist-packages (from pandas) (2.8.2)
Requirement already satisfied: numpy&gt;=1.18.5 in /usr/local/lib/python3.9/dist-packages (from pandas) (1.22.4)
Requirement already satisfied: pytz&gt;=2020.1 in /usr/local/lib/python3.9/dist-packages (from pandas) (2022.7.1)
Requirement already satisfied: six&gt;=1.5 in /usr/local/lib/python3.9/dist-packages (from python-dateutil&gt;=2.8.1-&gt;pandas) (1.16.0)
Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/
Requirement already satisfied: scikit-learn in /usr/local/lib/python3.9/dist-packages (1.2.2)
Requirement already satisfied: joblib&gt;=1.1.1 in /usr/local/lib/python3.9/dist-packages (from scikit-learn) (1.1.1)
Requirement already satisfied: threadpoolctl&gt;=2.0.0 in /usr/local/lib/python3.9/dist-packages (from scikit-learn) (3.1.0)
Requirement already satisfied: scipy&gt;=1.3.2 in /usr/local/lib/python3.9/dist-packages (from scikit-learn) (1.10.1)
Requirement already satisfied: numpy&gt;=1.17.3 in /usr/local/lib/python3.9/dist-packages (from scikit-learn) (1.22.4)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#import what we need later</span>
<span class="kn">import</span> <span class="nn">datasets</span>
<span class="kn">from</span> <span class="nn">datasets</span> <span class="kn">import</span> <span class="n">load_dataset</span>
<span class="kn">from</span> <span class="nn">datasets</span> <span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">DatasetDict</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-2-f3d11f56cc2a&gt;</span> in <span class="ni">&lt;cell line: 2&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1">#import what we need later</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="kn">import</span> <span class="nn">datasets</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="kn">from</span> <span class="nn">datasets</span> <span class="kn">import</span> <span class="n">load_dataset</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="kn">from</span> <span class="nn">datasets</span> <span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">DatasetDict</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> 

<span class="ne">ModuleNotFoundError</span>: No module named &#39;datasets&#39;

<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NOTE</span>: If your import is failing due to a missing package, you can
<span class="n">manually</span> <span class="n">install</span> <span class="n">dependencies</span> <span class="n">using</span> <span class="n">either</span> <span class="o">!</span>pip or !apt.

<span class="n">To</span> <span class="n">view</span> <span class="n">examples</span> <span class="n">of</span> <span class="n">installing</span> <span class="n">some</span> <span class="n">common</span> <span class="n">dependencies</span><span class="p">,</span> <span class="n">click</span> <span class="n">the</span>
<span class="s2">&quot;Open Examples&quot;</span> <span class="n">button</span> <span class="n">below</span><span class="o">.</span>
<span class="gt">---------------------------------------------------------------------------</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importamos la data</span>
<span class="n">our_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://www.dropbox.com/s/tbjr8g1hslb8q4o/Full-Economic-News-DFE-839861.csv?dl=1&quot;</span> <span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="s2">&quot;ISO-8859-1&quot;</span> <span class="p">)</span> \
            <span class="o">.</span><span class="n">sample</span><span class="p">(</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">2000</span> <span class="p">)</span> \
            <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span> <span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">our_data</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1054, 1)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Tomamos solamente dos columnas el texto y Y, relevance</span>
<span class="c1"># Cambiamos yes y No por 1 y 0</span>
<span class="n">mylen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">our_data</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
<span class="n">mytexts</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#will contain the text strings</span>
<span class="n">mylabels</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#will contain the label as 1 or 0 (Yes or No respectively)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">mylen</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">our_data</span><span class="p">[</span><span class="s1">&#39;relevance&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">mytexts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">our_data</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span>
        <span class="n">mylabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">our_data</span><span class="p">[</span><span class="s2">&quot;relevance&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="s2">&quot;no&quot;</span><span class="p">:</span>
        <span class="n">mytexts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">our_data</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span>
        <span class="n">mylabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;skipping&quot;</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="n">mytexts</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="n">mylabels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>skipping
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1999
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Separamos train y test data </span>
<span class="c1"># Solo 25% de data para test</span>
<span class="n">train_texts</span><span class="p">,</span> <span class="n">test_texts</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">test_labels</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">mytexts</span><span class="p">,</span> <span class="n">mylabels</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">.25</span><span class="p">)</span>
<span class="n">train_texts</span><span class="p">,</span> <span class="n">val_texts</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">val_labels</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">train_texts</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Obtenemos el modelo bert</span>
<span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">AutoTokenizer</span>
<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s1">&#39;bert-base-cased&#39;</span><span class="p">)</span>

<span class="c1"># Estemodelo tiene un tokenizador que usaremos para incorporar nuestra</span>
<span class="c1"># data</span>
<span class="n">train_encodings</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="p">(</span><span class="n">train_texts</span><span class="p">,</span> <span class="n">truncation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">val_encodings</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="p">(</span><span class="n">val_texts</span><span class="p">,</span> <span class="n">truncation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">test_encodings</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="p">(</span><span class="n">test_texts</span><span class="p">,</span> <span class="n">truncation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Introducimos nuestra data al modelo</span>
<span class="kn">import</span> <span class="nn">torch</span>

<span class="k">class</span> <span class="nc">MyDataset</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encodings</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>

        <span class="c1"># Seleccionamos los encodings. Texto/data</span>
        <span class="c1"># Labels, Y, lo que queremos predesir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encodings</span> <span class="o">=</span> <span class="n">encodings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>

        <span class="c1"># Cada texto lo convertimos en un vector tipo tensor</span>
        <span class="c1"># De igual manera los labels</span>
        <span class="n">item</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">encodings</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">item</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">item</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generamos la dataset para el input</span>
<span class="n">train_dataset</span> <span class="o">=</span> <span class="n">MyDataset</span><span class="p">(</span><span class="n">train_encodings</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>
<span class="n">test_dataset</span> <span class="o">=</span> <span class="n">MyDataset</span><span class="p">(</span><span class="n">test_encodings</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">)</span>
<span class="n">val_dataset</span> <span class="o">=</span> <span class="n">MyDataset</span><span class="p">(</span><span class="n">val_encodings</span><span class="p">,</span> <span class="n">val_labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Tomamos Bert para la clasificación</span>
<span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">BertForSequenceClassification</span><span class="p">,</span> <span class="n">Trainer</span><span class="p">,</span> <span class="n">TrainingArguments</span>
<span class="kn">from</span> <span class="nn">datasets</span> <span class="kn">import</span> <span class="n">load_metric</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Especificamos los argumentos para el re entrenamiento</span>
<span class="n">training_args</span> <span class="o">=</span> <span class="n">TrainingArguments</span><span class="p">(</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="s1">&#39;./results&#39;</span><span class="p">,</span>          <span class="c1"># output directory</span>
    <span class="n">num_train_epochs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>              <span class="c1"># total number of training epochs # number of times to change the model</span>
    <span class="n">per_device_train_batch_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>  <span class="c1"># batch size per device during training # number of observations</span>
    <span class="n">per_device_eval_batch_size</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>   <span class="c1"># batch size for evaluation # of obs for evaluation</span>
    <span class="n">warmup_steps</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>                <span class="c1"># number of warmup steps for learning rate scheduler</span>
    <span class="n">weight_decay</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>               <span class="c1"># strength of weight decay</span>
    <span class="n">logging_dir</span><span class="o">=</span><span class="s1">&#39;./logs&#39;</span><span class="p">,</span>            <span class="c1"># directory for storing logs</span>
    <span class="n">logging_steps</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Definimos la metrica para el re entrenamiento</span>
<span class="k">def</span> <span class="nf">compute_metrics</span><span class="p">(</span><span class="n">eval_preds</span><span class="p">):</span>
    <span class="n">metric</span> <span class="o">=</span> <span class="n">load_metric</span><span class="p">(</span><span class="s2">&quot;accuracy&quot;</span><span class="p">,</span> <span class="s2">&quot;f1&quot;</span><span class="p">)</span>
    <span class="n">logits</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">eval_preds</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">metric</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">predictions</span><span class="o">=</span><span class="n">predictions</span><span class="p">,</span> <span class="n">references</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>

<span class="c1"># Tomamos el modelo</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">BertForSequenceClassification</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;bert-base-cased&quot;</span><span class="p">)</span>

<span class="c1"># Instance del Re entrenamiento del Modelo</span>
<span class="n">trainer</span> <span class="o">=</span> <span class="n">Trainer</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>                         <span class="c1"># the instantiated 🤗 Transformers model to be trained</span>
    <span class="n">args</span><span class="o">=</span><span class="n">training_args</span><span class="p">,</span>                  <span class="c1"># training arguments, defined above</span>
    <span class="n">train_dataset</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span>         <span class="c1"># training dataset</span>
    <span class="n">eval_dataset</span><span class="o">=</span><span class="n">val_dataset</span><span class="p">,</span>           <span class="c1"># evaluation dataset</span>
    <span class="n">compute_metrics</span><span class="o">=</span><span class="n">compute_metrics</span>      <span class="c1">#specify metrics</span>

<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Some weights of the model checkpoint at bert-base-cased were not used when initializing BertForSequenceClassification: [&#39;cls.predictions.transform.dense.weight&#39;, &#39;cls.seq_relationship.bias&#39;, &#39;cls.predictions.bias&#39;, &#39;cls.seq_relationship.weight&#39;, &#39;cls.predictions.decoder.weight&#39;, &#39;cls.predictions.transform.LayerNorm.bias&#39;, &#39;cls.predictions.transform.dense.bias&#39;, &#39;cls.predictions.transform.LayerNorm.weight&#39;]
- This IS expected if you are initializing BertForSequenceClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertForSequenceClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of BertForSequenceClassification were not initialized from the model checkpoint at bert-base-cased and are newly initialized: [&#39;classifier.weight&#39;, &#39;classifier.bias&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Entrenando el modelo</span>
<span class="n">trainer</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.9/dist-packages/transformers/optimization.py:391: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
</pre></div>
</div>
<div class="output text_html">
    <div>
      
      <progress value='255' max='255' style='width:300px; height:20px; vertical-align: middle;'></progress>
      [255/255 01:34, Epoch 3/3]
    </div>
    <table border="1" class="dataframe">
  <thead>
 <tr style="text-align: left;">
      <th>Step</th>
      <th>Training Loss</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>10</td>
      <td>0.508100</td>
    </tr>
    <tr>
      <td>20</td>
      <td>0.505600</td>
    </tr>
    <tr>
      <td>30</td>
      <td>0.553900</td>
    </tr>
    <tr>
      <td>40</td>
      <td>0.430700</td>
    </tr>
    <tr>
      <td>50</td>
      <td>0.497200</td>
    </tr>
    <tr>
      <td>60</td>
      <td>0.464900</td>
    </tr>
    <tr>
      <td>70</td>
      <td>0.456900</td>
    </tr>
    <tr>
      <td>80</td>
      <td>0.481600</td>
    </tr>
    <tr>
      <td>90</td>
      <td>0.497000</td>
    </tr>
    <tr>
      <td>100</td>
      <td>0.432500</td>
    </tr>
    <tr>
      <td>110</td>
      <td>0.451200</td>
    </tr>
    <tr>
      <td>120</td>
      <td>0.493300</td>
    </tr>
    <tr>
      <td>130</td>
      <td>0.509600</td>
    </tr>
    <tr>
      <td>140</td>
      <td>0.525000</td>
    </tr>
    <tr>
      <td>150</td>
      <td>0.451200</td>
    </tr>
    <tr>
      <td>160</td>
      <td>0.479000</td>
    </tr>
    <tr>
      <td>170</td>
      <td>0.473200</td>
    </tr>
    <tr>
      <td>180</td>
      <td>0.423700</td>
    </tr>
    <tr>
      <td>190</td>
      <td>0.467900</td>
    </tr>
    <tr>
      <td>200</td>
      <td>0.447600</td>
    </tr>
    <tr>
      <td>210</td>
      <td>0.405200</td>
    </tr>
    <tr>
      <td>220</td>
      <td>0.493200</td>
    </tr>
    <tr>
      <td>230</td>
      <td>0.458900</td>
    </tr>
    <tr>
      <td>240</td>
      <td>0.431900</td>
    </tr>
    <tr>
      <td>250</td>
      <td>0.450800</td>
    </tr>
  </tbody>
</table><p></div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TrainOutput(global_step=255, training_loss=0.47049392812392293, metrics={&#39;train_runtime&#39;: 95.2231, &#39;train_samples_per_second&#39;: 42.5, &#39;train_steps_per_second&#39;: 2.678, &#39;total_flos&#39;: 1064810441041920.0, &#39;train_loss&#39;: 0.47049392812392293, &#39;epoch&#39;: 3.0})
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="c1"># Testeando la predicción del modelo</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">predictions</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">predictions</span><span class="o">.</span><span class="n">label_ids</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">predictions</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">metric</span> <span class="o">=</span><span class="n">load_metric</span><span class="p">(</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="s1">&#39;f1&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">metric</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">predictions</span><span class="o">=</span><span class="n">preds</span><span class="p">,</span> <span class="n">references</span><span class="o">=</span><span class="n">predictions</span><span class="o">.</span><span class="n">label_ids</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"></div><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-33-f345038ad355&gt;:15: FutureWarning: load_metric is deprecated and will be removed in the next major version of datasets. Use &#39;evaluate.load&#39; instead, from the new library 🤗 Evaluate: https://huggingface.co/docs/evaluate
  metric = load_metric(&quot;accuracy&quot;, &quot;f1&quot;)
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "9b44cc67c3d0446c98d9f6cca7d085ec"}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(500, 2) (500,)
{&#39;accuracy&#39;: 0.828}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Evaluamos el resultado</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>
<span class="nb">print</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">label_ids</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[  0  86]
 [  0 414]]
</pre></div>
</div>
</div>
</div>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://econnlpcourse.github.io/">https://econnlpcourse.github.io/</a></p></li>
<li><p><a class="reference external" href="https://huggingface.co/docs/transformers/training">https://huggingface.co/docs/transformers/training</a></p></li>
<li><p><a class="reference external" href="https://www.dropbox.com/s/6vs85d2lqx03r0e/Abad_Gago_et_al.pdf?dl=0">https://www.dropbox.com/s/6vs85d2lqx03r0e/Abad_Gago_et_al.pdf?dl=0</a> (GOLAZO)</p></li>
<li><p>Curso de NLP QLAB</p></li>
</ol>
</section>
<div class="toctree-wrapper compound">
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="Analyze_ab_test_results_notebook.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Analyze A/B Test Results</p>
      </div>
    </a>
    <a class="right-next"
       href="OffensiveEJPM.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Importing the transformer</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">NLP</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#text-pre-processing">Text Pre Processing</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#tokenizacion">Tokenización</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#instalacion-y-configuracion-spacy">Instalación y Configuración Spacy</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tokenizacion-por-sentencia">Tokenización por sentencia</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tokenizacion-por-espacio">1) Tokenización por espacio</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tokenizacion-basado-en-palabras">2) Tokenización basado en palabras</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tokenizacion-para-sub-palabras">3) Tokenización para sub-palabras</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-encoding-vectorizacion">Feature Encoding - Vectorización</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#buscando-similaridad">Buscando Similaridad</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reentrenando-modelos-de-nlp-fine-tuning">Reentrenando modelos de NLP (FINE-TUNING)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Cristian Serrano
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>